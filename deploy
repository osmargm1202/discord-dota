#!/bin/bash

set -e

# Colores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Configuraci√≥n
REGISTRY="orgmcr.or-gm.com"
USERNAME="osmargm1202"
IMAGE_NAME="dota-discord-bot"
TAG="latest"
FULL_IMAGE="${REGISTRY}/${USERNAME}/${IMAGE_NAME}:${TAG}"
SERVER="server"

echo -e "${GREEN}üöÄ Iniciando deployment de ${IMAGE_NAME}...${NC}"

# 1. Construir la imagen
echo -e "${YELLOW}üì¶ Construyendo imagen Docker...${NC}"
docker build -t ${FULL_IMAGE} .

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå Error construyendo la imagen${NC}"
    exit 1
fi

# 2. Hacer push al registry
echo -e "${YELLOW}üì§ Subiendo imagen al registry...${NC}"
docker push ${FULL_IMAGE}

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå Error subiendo la imagen al registry${NC}"
    exit 1
fi
